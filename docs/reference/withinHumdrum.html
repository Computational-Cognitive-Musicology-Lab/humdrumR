<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Apply arbitrary expressions to fields within humdrumR data."><title>with(in)Humdrum — withinHumdrum • humdrumR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="with(in)Humdrum — withinHumdrum"><meta property="og:description" content="Apply arbitrary expressions to fields within humdrumR data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">humdrumR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basics</h6>
    <a class="dropdown-item" href="../articles/Overview.html">Overview of humdrumR</a>
    <a class="dropdown-item" href="../articles/GettingStarted.html">Getting started with humdrumR</a>
    <a class="dropdown-item" href="../articles/IntroForCoders.html">HumdrumR for Coders</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>R/Humdrum background</h6>
    <a class="dropdown-item" href="../articles/HumdrumSyntax.html">The Humdrum Syntax</a>
    <a class="dropdown-item" href="../articles/RPrimer.html">An R Primer for humdrumR</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Data prep</h6>
    <a class="dropdown-item" href="../articles/ReadWrite.html">Reading and writing data</a>
    <a class="dropdown-item" href="../articles/Validation.html">Validating Humdrum Data</a>
    <a class="dropdown-item" href="../articles/Reshaping.html">Shaping Humdrum Data</a>
    <a class="dropdown-item" href="../articles/Filtering.html">Filtering Humdrum Data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/Summary.html">Summarizing humdrum data sets</a>
    <a class="dropdown-item" href="../articles/WorkingWithData.html">Working with Humdrum Data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Musical tools</h6>
    <a class="dropdown-item" href="../articles/PitchAndTonality.html">Pitch and Tonality in humdrumR</a>
    <a class="dropdown-item" href="../articles/RhythmAndMeter.html">Rhythm and Meter in humdrumR</a>
    <a class="dropdown-item" href="../articles/KeysAndChord.html">Diatonic and Tertian Sets in humdrumR</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="https://github.com/Computational-Cognitive-Musicology-Lab/humdrumR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>with(in)Humdrum</h1>
      <small class="dont-index">Source: <a href="https://github.com/Computational-Cognitive-Musicology-Lab/humdrumR/blob/HEAD/R/Apply.R"><code>R/Apply.R</code></a></small>
      <div class="d-none name"><code>withinHumdrum.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Apply arbitrary expressions to fields within <a href="humdrumRclass.html">humdrumR</a> data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S3 method for humdrumR</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span>, dataTypes <span class="op">=</span> <span class="st">"D"</span>, drop <span class="op">=</span> <span class="cn">TRUE</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># S3 method for humdrumR</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span>, dataTypes <span class="op">=</span> <span class="st">"D"</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>...</dt>
<dd><p>Any number of do expressions or evaluation modifying expressions.</p></dd>
<dt>dataTypes</dt>
<dd><p>A string or vector of characters drawn from <code>c("D", "d", "I", "L", "M","G")</code>.
These characters  correspond to types of humdrum records: <strong>D</strong>ata, null <strong>d</strong>ata, <strong>I</strong>nterpretations,
<strong>M</strong>easures, <strong>L</strong>ocal comments, and <strong>G</strong>lobal comments respectively. The expression
is only evaluated on data drawn from the specified record types (defaults to <code>"D"</code>).</p></dd>
<dt>drop</dt>
<dd><p>This argument is conceptually similar to the <code>drop</code> argument in R matrices.
If <code>drop = TRUE</code>, the output of <code>with.humdrumR</code> is simplified as much as possible (trying to return
the "raw" vector, list, table, etc. within it). If <code>drop = FALSE</code>, the result is <em>always</em>
a <code>data.table</code>. The default value (<code>drop = TRUE</code>) is usually what we want because it is more
intuitive, but in more complex code, it can be helpful to set <code>drop = FALSE</code> so that
the output is consistent.</p></dd>
<dt>humdrumR</dt>
<dd><p>A <code>[humdrumR][humdrumRclass]</code> data object.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>From <code>within.humdrumR</code>  a new humdrumR data object.
From <code>with.humdrumR</code>, whatever value is returned by the expression or, if <code>drop = TRUE</code>,
a <code>data.table</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
    


<p>These functions are the primary means of working with
humdrumR data. They are analogous to the base functions
<a href="https://rdrr.io/r/base/with.html" class="external-link">with and within</a>
methods for <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frames</a>.
Specifically they allow you to evaluate arbitrary
expressions involving fields in a <a href="humdrumRclass.html">humdrumR data object</a>.
They also includes a number of special evaluation options:</p><ul><li><p>Evaluate an expression in a subset of the data.</p></li>
<li><p>Evaluate the same expression separately in different subsets of the data.</p></li>
<li><p>Evaluate an expression across windows in the data (e.g., ngrams, rolling windows).</p></li>
<li><p>Evaluate an expression which produces a plot, with particular plotting parameters set using <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">graphics::par()</a></code>.</p></li>
</ul><p>The difference between <code>with.humdrumR</code> and <code>within.humdrumR</code> is
analogous to the difference between <code><a href="https://rdrr.io/r/base/with.html" class="external-link">base::with()</a></code> and <code><a href="https://rdrr.io/r/base/with.html" class="external-link">base::within()</a></code>.
<code>with.humdrumR</code> evaluates your expression(s) and then simply returns the result of
the evaluation. <code>within.humdrumR</code> evaluates your expression(s) and then
inserts the results back into the humdrumR object (if possible), generating new
fields called <code>ResultX</code> (see details).</p>
    </div>
    <div class="section level2">
    <h2 id="expression-evaluation">Expression evaluation<a class="anchor" aria-label="anchor" href="#expression-evaluation"></a></h2>
    


<p>An "expression" is a legal bit of R code, like <code>2 + 2</code> or <code>x - mean(x)</code>.
Each call to <code>with</code>/<code>within.humdrumR</code> must have at least one expression to evaluate,
or "<em>do</em>"  which we call "do" expressions.
These expressions are evaluated (executed) within the <code>humdrumR</code> object's humdrum table.
which means the expression can, refer to any field in the humdrumR object (<code>Record</code>, <code>Token</code>, <code>File</code>, etc.).
Since all the fields in a data.table are all vectors of the same length, expressions should usually be
vectorized.</p>
<p>A number of special <a href="https://en.wikipedia.org/wiki/Syntactic_sugarsyntactic" class="external-link">syntactic sugars</a>
can be used in the "do" expressions.
The most basic, is that a <code>.</code> anywhere in the expression, will be
interpreted as the humdrumR object's current <a href="humActive.html">active expression</a>.
More syntactic sugars are described below.</p>
<p>If multiple do expressions are provided, each expression is evaluated in order, and
can refer to results of the previous do expression as <code>.</code> (variables assigned in previous expressions
can also be used.)
Other syntactic sugars are described in sections below.</p><div class="sourceCode"><pre><code><span class="va">humdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readHumdrum.html">readHumdrum</a></span><span class="op">(</span><span class="va">humdrumRroot</span>, <span class="st">'HumdrumData/BachChorales/.*krn'</span><span class="op">)</span> <span class="co"># read some data</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="../reference/pitch.html">pitch</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="../reference/pitch.html">pitch</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="co"># Same as previous (unless `Active` field has been changed))</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/solfa.html">solfa</a></span><span class="op">(</span><span class="va">Token</span>, Key <span class="op">=</span> <span class="va">Key</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Assumes that the Key field was parsed during the call to `[readHumdrum][readHumdrum]`</span>

<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="../reference/semits.html">semits</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/semits.html">semits</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<p>Unnamed arguments (or formulae without a left-hand side) are interpreted as <code>do</code> expressions.
Do expressions can also be explicitly labeled by naming an argument "do" or with <code>do</code> on the left side
of a formula:</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">chorales</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">chorales</span>, do <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">chorales</span>, <span class="va">do</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span>
<span class="co"># These all return the same result</span></code></pre></div>
<div class="section">
<h3 id="special-do">Special Do<a class="anchor" aria-label="anchor" href="#special-do"></a></h3>


<p>A few special versions of the <code>do</code> expression can be used.</p><ul><li><p><code>doplot</code>:</p><ul><li><p>The expression is evaluated, but the original <code>humdrumR</code> input
if returned unchanged. This can be used for achieving a side effect (like making a plot)
without saving the result.</p></li>
</ul></li>
<li><p><code>dofill</code>:</p><ul><li><p>The result is evaluated, and the result is recycled to the length of the input, making
sure the result is the same length as the input.
Basically, do fill is the equivalent of <code>rep(do ~ f(x), length.out = length(x))</code>.</p></li>
</ul></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="special-evaluation-keywords">Special Evaluation Keywords<a class="anchor" aria-label="anchor" href="#special-evaluation-keywords"></a></h2>
    


<p><code>with.humdrumR</code> and <code>within.humdrumR</code> can be provided with
additional keyword expressions which modify how the main "do" expressions are evaluated.
The complete list of options are:</p><ul><li><p><code>by</code> (group by)</p></li>
<li><p><code>where</code> (apply to subset)</p></li>
<li><p><code>windows</code></p></li>
<li><p><code>ngrams</code></p></li>
<li><p><code>pre</code> and <code>post</code></p></li>
</ul><p>These special expressions can be specified either as named arguments
(<code>with(data, do(x), by = group)</code>) or as formula, with the keyword on the left side
(<code>with(data, do(x), by ~ group</code>).
Any unnamed argument (or formula without a left-side) is interpreted as a <code>do</code> expression,
not a special expression.</p><ul><li><p>A <code>by</code> expression is used to break the data into groups, with the <code>do</code> expression(s) evaluated
separately in each group (see "Group by", below).</p></li>
<li><p>A <code>where</code> expression indicates a subset of the data
in which to evaluate the <code>do</code> expression (see "Partitioning", below).</p></li>
<li><p><code>ngrams</code> A positive number <em>n</em>. The expression is evaluated across overlapping length-<em>n</em> windows.
+. <code>pre</code> An expression to evaluate once before evaluating the do expression(s). Useful, for instance, for taking logs
or opening a graphing window. The <code>pre</code> expression is evaluated in the global environment.
+. <code>post</code> An expression evaluate once after evaluating the do expression(s). Always evaluated in the global environment.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="group-by">Group by<a class="anchor" aria-label="anchor" href="#group-by"></a></h2>
    


<p>A <code>by</code> expression is used to break the data into subsets, with the <code>do</code> expression(s) evaluated
separately within each subset. This works the similarly to the <code>by</code> argument in
<code>[data.table][data.table]</code>s, the <code>INDEX</code>
argument of <code>[base][tapply]</code>, or the <code>INDICES</code> argument of <code>[base][by]</code>.
Each <code>by</code> expression must evaluate, within the <code>humdrumR</code> data object, to a vector (or a list of vectors
of equal length) of categories to group the data by.</p>
<p>Most commonly, the <code>by</code> expression(s) are simply field(s) in the data:
for instance,</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">humdata</span>,
     do <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span>,
     by <span class="op">=</span> <span class="va">File</span><span class="op">)</span></code></pre></div>

<p>will apply the function <code>[base][table]</code> to the <code>Token</code> field
<em>separately</em> for each file in the <code>humdrumR</code> data.
However, we can also use more complex expressions like</p><div class="sourceCode"><pre><code>with(humdata,
     do = table(Token), 
     by = Spine &gt; 3 | Record \%\% 2 == 0)
</code></pre></div>

<p>which will evaluate the do expression in two groups, one where either the spine number is
three or less <em>or</em> the record number is even, and another group where the opposite is true.</p>
<p>If the <code>by</code> expression evaluates to a list of grouping vectors,
the <code>do</code> expressions are evaluated across every combination of categories in all the vectors.
Thus,</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">humdata</span>, 
     do <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span>,
     by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">File</span>, <span class="va">Spine</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<p>will apply <code>table</code> to <code>Token</code> across each spine <em>in</em> each file.</p>
<p>As some <a href="https://en.wikipedia.org/wiki/Syntactic_sugarsyntactic" class="external-link">syntactic sugar</a>, if the
<code>by</code> expression is input as a formulae, lists of grouping expressions
can be created by separating each expression by a <code>~</code>.
Thus, <code>by = list(File ~ Spine)</code> can be written
<code>by = File ~ Spine</code> or <code>by ~ File ~ Spine</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="apply-where-true">Apply where TRUE<a class="anchor" aria-label="anchor" href="#apply-where-true"></a></h2>
    


<p>A <code>where</code> expression is used to identify a subset of the data and evaluate
the <code>do</code> expression(s) <em>only</em> in that subset.
<code>where</code> expressions must evaluate, within the <code>humdrumR</code> data object, to
a single logical vector. The <code>do</code> expression(s) are only evaluated where this logical
vector is <code>TRUE</code>.
kept unchanged.</p>
    </div>
    <div class="section level2">
    <h2 id="advanced-partitioning">Advanced partitioning<a class="anchor" aria-label="anchor" href="#advanced-partitioning"></a></h2>
    


<p>If multiple <code>by</code> or <code>where</code> expressions, or combinations of the two, are specified,
each is evaluated recursively, in order from left to right.
If <code>where</code> is specified after <code>by</code>, the <code>where</code> expression is evaluated within each <code>by</code> group
If <code>by</code> is specified after <code>where</code>, the grouping <code>by</code> expression is evaluated only where <code>where == TRUE</code>.
Thus, if you specify</p><div class="sourceCode"><pre><code>within(humdata,
         do = sd(Semits),
         by = File, 
         where = Semits &gt; mean(Semits))
```

the standard deviation of the `semits` field will be calculated in each file,
but only where the `semits` field is greater than the mean `semits` value
*within that file*. Contrast this with this call:

```
within(humdata,
         do = sd(Semits)
         where = Semits &gt; mean(Semits), 
         by = File) 
```

wherein the standard deviation of `semits` is, again, calculated for each file,
but this time wherever the `semits` field is greater than the mean value *across all the data*.
</code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a></h2>
    


<p>The <code>doplot</code> keyword behaves exactly like the <code>do</code> keyword, except that the result of the
evaluation is ignored. This is useful for plotting as well as <em>other</em> side-effects (like writing to a file).
If <code>doplot</code> is used with <code>with.humdrumR</code>, the function simply returns <code>NULL</code> (after executing the <code>doplot</code>
expression.
If <code>doplot</code> is used with <code>within.humdrumR</code>, the function simply returns the unaltered
<code>humdrumR</code> argument.</p>
<p><code>within.humdrumR</code> also allows you to specify plotting options inline, without having to make a separate call
to <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code>. Any <code><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par()</a></code> argument can be specified by providing a named list to the <code>graphics</code> keyword.
For example, we can set the plot margins with the <code>mar</code> argument:</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">data</span>, 
       doplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
       graphics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<p>The best part is <code>within.humdrumR</code> will reset <code>par</code> to it's previous state after its done.</p>
<p>You can also use the syntactic sugar, <code>graphics(parargs = ...)</code>:</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">data</span>,
       doplot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">Token</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/r/graphics/graphics-package.html" class="external-link">graphics</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="tandem-interpretations">Tandem interpretations<a class="anchor" aria-label="anchor" href="#tandem-interpretations"></a></h2>
    


<p>The function <code>[readHumdrum][readHumdrum]</code> automatically parses
tandem interpretations (that it recognizes) into
their own fields in the resulting <code>[humdrumR][humdrumRclass]</code> data.
For instance, data with a <code>'*clefF4'</code> will show
up as a <code>Clef</code> field. However, users might read humdrum data with their
own custom tandem interpretations that are not built into <code>humdrumR</code>.
<code>humdrumR</code> includes the function <code>[getTandem][getTandem]</code> to help us
extract arbitrary tandem intrpretation data.
Luckily, <code>within.humdrumR</code> knows some
<a href="https://en.wikipedia.org/wiki/Syntactic_sugarsyntactic" class="external-link">syntactic sugar</a>
which makes it easy to do this anywhere in our expressions, simply by putting a
named object beginning with the symbol <code>*</code>. Of course, R doesn't normally
allow names to begin with symbols like <code>*</code>, but you can force it by
placing grave symbols around the name <code>*name</code>. If you do this in a <code>within.humdrumR</code>
expression, <code>within.humdrumR</code> will treat this name as a
regular expression and substitute a call <code>getTandem(Tandem, 'regular expression')</code> in the expression.
This means you can could do something like
within(humdata,
do ~ myFunction(Token, <code>*mytandempattern</code>))
and <code>myFunction</code> will be called with the first argument being the
<code>Token</code> field, and the second argument being tandem interpretations
which match <code>'mytandempattern'</code> (extracted from the <code>Tandem</code> field).</p>
    </div>
    <div class="section level2">
    <h2 id="splatting">Splatting<a class="anchor" aria-label="anchor" href="#splatting"></a></h2>
    


<p>("Splatting" refers to feeding a function a list/vector of arguments.)
Sometimes we want to divide our data into pieces (a l\'a <code>partition</code> option), but
rather than applying the same expression to each piece, we want to feed
the separate pieces as separate arguments to the same function.
In <code>with(in).humdrumR</code> you can use some
<a href="https://en.wikipedia.org/wiki/Syntactic_sugarsyntactic" class="external-link">syntactic sugar</a>
to do just this.
We can index any field in our call with a <code>splat</code> argument, which must be a <code>Field %in% x</code>.
For example,</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Token</span><span class="op">[</span>splat <span class="op">=</span> <span class="va">Spine</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<p>In this call, the <code>Token</code> field will be divided into two groups, one where <code>Spine == 1</code> and the other where
<code>Spine == 2</code>; the first group (<code>Spine == 1</code>) will be used as the first argument to <code>list</code>, and the second group
(<code>Spine == 2</code>) as the second argument.
Thus, <code>wihtin.humdrumR</code> translates the previous expression to this:</p><div class="sourceCode"><pre><code><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Token</span><span class="op">[</span><span class="va">Spine</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>, <span class="va">Token</span><span class="op">[</span><span class="va">Spine</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="argument-interpolation">Argument interpolation<a class="anchor" aria-label="anchor" href="#argument-interpolation"></a></h2>
    


<p>The <code>variables</code> argument is a list of named arguments which are <code>[humdrumR:interpolateArguments][interpolated]</code> into the
<code>do</code> expressions. This is useful if you've already created a list of formulas that you like, but would like
to make small changes to a function call within the <code>do</code> expressions, without starting from scratch.
Examples:</p><div class="sourceCode"><pre><code><span class="va">mycommand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">do</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.</span>, na.rm <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, <span class="va">by</span> <span class="op">~</span> <span class="va">Spine</span> <span class="op">~</span> <span class="va">File</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>,
              <span class="va">mycommand</span>,
              <span class="fu">variables</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="n-grams">N grams<a class="anchor" aria-label="anchor" href="#n-grams"></a></h2>
    


    </div>
    <div class="section level2">
    <h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a></h2>
    


<p>The difference between <code>with.humdrumR</code> and <code>within.humdrumR</code> is in what they do with the results
of the evaluated do expression(s).</p><div class="section">
<h3 id="with">With<a class="anchor" aria-label="anchor" href="#with"></a></h3>


<p>For calls to <code>with.humdrumR</code>, the result is simply returned as is.
This is what you want when you want to get out of thue humdrumR object and drop back into "normal" R,
often in the last stages of an analysis.
However, you may optionally specify <code>drop = FALSE</code>, in which case the result is returned
in a <code>data.table()</code>.</p>
</div>

<div class="section">
<h3 id="within">Within<a class="anchor" aria-label="anchor" href="#within"></a></h3>


<p>For calls to <code>within.humdrumR</code>, the result of each <code>do</code> expression
is inserted back into the <code>[humtable][humdrum table]</code>.
Usually, <code>do</code> expressions should evaluate to atomic output which is the same length as the input:
in other words, every data point in the input field(s) correspond to a single data point in the new field.
However, if the results are shorter than input fields humtable,
they are padded with null tokens to match the full (original) length.</p><div class="section">
<h4 id="naming-results">Naming results<a class="anchor" aria-label="anchor" href="#naming-results"></a></h4>


<p>If you don't explicitely name the results, they are put into new field(s) labeled
<code>Result1</code>, <code>ResultX</code>, <code>...</code>, <code>ResultN</code>.
You can name the new fields in one of two ways:</p><ul><li><p>normal R assignment, using <code>&lt;-</code> or <code>-&gt;</code> anywhere in a do expression.</p><ul><li><p>For example, <code>within(data, Semits &lt;- semits(Token))</code>.</p></li>
</ul></li>
<li><p>end the expression with a named list.</p><ul><li><p>For example, <code>within(data, list(Semits = semits(Token)))</code></p></li>
</ul></li>
</ul></div>


</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">humdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="readHumdrum.html">readHumdrum</a></span><span class="op">(</span><span class="st">'directorywithdata/*.krn'</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding and reading files...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 	REpath-pattern 'directorywithdata/*.krn' matches 0 text files in 0 directories.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Zero files read from disk.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No files to validate.</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="co"># counts characters in each data token.</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("within"):</span> no applicable method for 'within' applied to an object of class "NULL"</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">humdata</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">by</span> <span class="op">~</span> <span class="va">Spine</span><span class="op">)</span> <span class="co"># Tabulates data tokens in each Spine.</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in UseMethod("within"):</span> no applicable method for 'within' applied to an object of class "NULL"</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="http://fathermckenzie.net/" class="external-link">Nathaniel
Condit-Schultz</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

