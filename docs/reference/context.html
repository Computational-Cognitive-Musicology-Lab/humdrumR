<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The context() command can be used to group input data (vectors)
into arbitrary contextual windows.
Unlike the contextual-grouping you can achieve with groupby arguments
to various functions (or by expressions in with(in).humdrumR)),
context() can produce windows that overlap or, the opposite case, that don't exhaustively
divide the data.
The context() should generally be used as a special argument to
with(in).humdrumR), but it can also be called directly itself."><title>Create arbitrary "context" across vectors. — context • humdrumR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create arbitrary " context across vectors.><meta property="og:description" content="The context() command can be used to group input data (vectors)
into arbitrary contextual windows.
Unlike the contextual-grouping you can achieve with groupby arguments
to various functions (or by expressions in with(in).humdrumR)),
context() can produce windows that overlap or, the opposite case, that don't exhaustively
divide the data.
The context() should generally be used as a special argument to
with(in).humdrumR), but it can also be called directly itself."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">humdrumR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basics</h6>
    <a class="dropdown-item" href="../articles/GettingStarted.html">Getting started with humdrumR</a>
    <a class="dropdown-item" href="../articles/IntroForCoders.html">HumdrumR for coders</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>R/Humdrum background</h6>
    <a class="dropdown-item" href="../articles/HumdrumSyntax.html">The humdrum syntax</a>
    <a class="dropdown-item" href="../articles/RPrimer.html">An R primer for humdrumR users</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Data prep</h6>
    <a class="dropdown-item" href="../articles/ReadWrite.html">Reading and writing data</a>
    <a class="dropdown-item" href="../articles/Reshaping.html">Shaping humdrum data</a>
    <a class="dropdown-item" href="../articles/Filtering.html">Filtering humdrum data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Analysis</h6>
    <a class="dropdown-item" href="../articles/Summary.html">Getting to know your data</a>
    <a class="dropdown-item" href="../articles/WorkingWithData.html">Working with humdrum data</a>
    <a class="dropdown-item" href="../articles/Context.html">Contextualizing data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Musical tools</h6>
    <a class="dropdown-item" href="../articles/PitchAndTonality.html">Pitch and tonality in humdrumR</a>
    <a class="dropdown-item" href="../articles/RhythmAndMeter.html">Time, rhythm, and meter in humdrumR</a>
    <a class="dropdown-item" href="../articles/KeysAndChord.html">Diatonic and tertian sets in humdrumR</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Computational-Cognitive-Musicology-Lab/humdrumR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create arbitrary "context" across vectors.</h1>
      <small class="dont-index">Source: <a href="https://github.com/Computational-Cognitive-Musicology-Lab/humdrumR/blob/HEAD/R/Context.R" class="external-link"><code>R/Context.R</code></a></small>
      <div class="d-none name"><code>context.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>context()</code> command can be used to group input data (vectors)
into arbitrary contextual windows.
Unlike the contextual-grouping you can achieve with <code>groupby</code> arguments
to various functions (or <code>by</code> expressions in with(in).humdrumR)),
<code>context()</code> can produce windows that <em>overlap</em> or, the opposite case, that don't exhaustively
divide the data.
The <code>context()</code> should generally be used as a special argument to
with(in).humdrumR), but it can also be called directly itself.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">context</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">open</span>,</span>
<span>  <span class="va">close</span>,</span>
<span>  reference <span class="op">=</span> <span class="va">x</span>,</span>
<span>  overlap <span class="op">=</span> <span class="st">"paired"</span>,</span>
<span>  depth <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rightward <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  duplicate_indices <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_length <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  max_length <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  inPlace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  complement <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  alignToOpen <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">","</span>,</span>
<span>  stripRegex <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  groupby <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p><em><strong>Input data to group into windows.</strong></em></p>
<p>Must be an atomic vector.</p></dd>


<dt>open</dt>
<dd><p><em><strong>Where to "open" (start) windows.</strong></em></p>
<p>Can be natural numbers, <code>logical</code> vectors (of the same length as <code>x</code>),
a single <code>character</code> string (interpreted as a regular expression).
May also be an arbitrary expression which returns natural numbers;
the expression can refer to named elements of <code>reference</code>, to <code>end</code> (last index),
to <code>close</code>, or to <code>prevclose</code> (the previous close).</p></dd>


<dt>close</dt>
<dd><p><em><strong>Where to "close" (end) windows.</strong></em></p>
<p>Can be natural numbers, <code>logical</code> vectors (of the same length as <code>x</code>),
a single <code>character</code> string (interpreted as a regular expression).
May also be an arbitrary expression which returns natural numbers;
the expression can refer to named elements of <code>reference</code>, to <code>end</code> (previous index),
to <code>open</code>, or to <code>nextopen</code> (the next open).</p></dd>


<dt>reference</dt>
<dd><p><em><strong>Vector(s) to use to identify window open/closes.</strong></em></p>
<p>Defaults to <code>x</code>.</p>
<p>Must be either an atomic vector of the same length as <code>x</code>, or a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>/<code>data.frame</code>
of such vectors, all <a href="https://rdrr.io/r/base/names.html" class="external-link">named</a>.</p></dd>


<dt>overlap</dt>
<dd><p><em><strong>How are overlapping windows treated/created?</strong></em></p>
<p>Defaults to <code>'paired'</code>.</p>
<p>Must be a single <code>character</code>, <a href="partialMatching.html">partially matching</a>
either <code>"paired"</code>, <code>"nested"</code>, <code>"edge"</code>, or <code>"none"</code>.</p></dd>


<dt>depth</dt>
<dd><p><em><strong>How "deep" can windows overlap?</strong></em></p>
<p>Defaults to <code>NULL</code>.</p>
<p>Must be <code>NULL</code>, or a vector of non-zero whole numbers.</p></dd>


<dt>rightward</dt>
<dd><p><em><strong>Should window alignment/overlap be determined from left to right?</strong></em></p>
<p>Defaults to <code>TRUE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>duplicate_indices</dt>
<dd><p><em><strong>Can the same index open/close multiple windows?</strong></em></p>
<p>Defaults to <code>TRUE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>min_length, max_length</dt>
<dd><p><em><strong>The minimum/maximum lengths of output windows.</strong></em></p>
<p>Default to two and infinity (no maximum) respectively.</p>
<p>Must be single, positive whole numbers.</p></dd>


<dt>inPlace</dt>
<dd><p><em><strong>Should output be padded to same length as input?</strong></em></p>
<p>Defaults to <code>FALSE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>complement</dt>
<dd><p><em><strong>Should input "outside" any windows, be output?</strong></em></p>
<p>Defaults to <code>FALSE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>alignToOpen</dt>
<dd><p><em><strong>Should '<code>inPlace</code>' output be aligned to the open of each window?</strong></em></p>
<p>Defaults to <code>TRUE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>collapse</dt>
<dd><p><em><strong>Should output windows be collapsed to single <code>character</code> strings?</strong></em></p>
<p>Defaults to <code>TRUE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>sep</dt>
<dd><p><em><strong>Separator for collapsed output.</strong></em></p>
<p>Defaults to a comma (<code>","</code>).</p>
<p>Must be a single <code>character</code> string.</p></dd>


<dt>stripRegex</dt>
<dd><p><em><strong>Should regular expressions matched by the <code>open</code>/<code>close</code> arguments be removed from the output?</strong></em></p>
<p>Defaults to <code>FALSE</code>.</p>
<p>Must be a singleton <code>logical</code> value: an on/off switch.</p></dd>


<dt>groupby</dt>
<dd><p><em><strong>Optional vectors to group windows within.</strong></em></p>
<p>Defaults to empty <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>.</p>
<p>Must be a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>, which is either empty or contains vectors which are all the same length as <code>x</code>.
In calls to <a href="withinHumdrum.html">with/within.humdrumR</a>, <code>groupby</code> is passed <code>list(Piece, Spine, Path)</code> by default.</p>
<p>Windows cannot cross group boundaries.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>context()</code> takes an input vector (<code>x</code>) and divides it into windows based on
the content of the <code>reference</code> vector, which must be the same length as <code>x</code>---
by default, <code>x</code> is reused as <code>reference</code>, so windows are based on the input <code>x</code> itself.
As a more complex option, <code>reference</code> can be a named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> or <code>data.frame</code> (<code>nrow == length(x)</code>)---
the (named) elements of <code>reference</code> are then visible to the <code>open</code> and <code>close</code> arguments (see below).</p>
<p>The <code>collapse</code>, <code>inPlace</code>, and <code>complement</code> arguments how windows are output.</p><ul><li><p>The "complement" refers to elements of the input vector that don't fall inside
any indicated windows: if <code>complement = FALSE</code> (the default), these "outside" values are
dropped; if <code>complement = TRUE</code>, they are retained.</p></li>
<li><p>If <code>inPlace = TRUE</code>, windows are output in a vector of the same length as the input,
padded with <code>NA</code> as needed---otherwise (the default), only the windows are returned</p></li>
<li><p>If <code>collapse = TRUE</code>, the windows are collapsed to strings (separed by <code>sep</code>), otherwise,
a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> of windows is returned.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="defining-windows">Defining windows<a class="anchor" aria-label="anchor" href="#defining-windows"></a></h2>
    


<p>The system <code>context()</code> uses to define/identify windows in the data is quite sophisticated,
and can take some time to master!
The basic idea is that you must indicate where you want windows to start ("<em>open</em>") and
where you want them to end ("<em>close</em>"):
you indicate this using the <code>open</code> and <code>close</code> arguments.
These arguments simple indicate indices in the input vector;
For example, if we want a window to open at the 4th and 11th indices,
and close at the 15th and 24th index,
we can write (using the built-in <code>letters</code> vector for practice):</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">11</span>), <span class="at">close =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">24</span>))</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span></code></pre><p></p></div>
<p>This is quite trivial.
However, the <code>open</code> and <code>close</code> arguments can actually be arbitary expressions
which do a number of special tricks, including refering to each other.
For example, if either argument includes a call to <code><a href="hop.html">hop()</a></code>,
<code><a href="hop.html">hop()</a></code> will automatically be applied along the input vector.
Consider this example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="fu">hop</span>(<span class="dv">2</span>), <span class="at">close =</span> open <span class="sc">+</span> <span class="dv">3</span>)</span></code></pre><p></p></div>
<p>In this example, the <code><a href="hop.html">hop()</a></code> command generates <code>open</code> indices for every odd
number from <code>1</code> to <code>25</code>.
The <code>close</code> argument then references these <code>open</code> indices, and adds <code>3</code> to each---
the result is the pairs like <code>1:4</code>, <code>2:5</code>, <code>3:6</code>, <code>4:7</code>, etc.
If we give <code><a href="hop.html">hop()</a></code> different arguments (like <code>by</code> or <code>from</code>), we can modify this process.
In fact, if we use the default <code>by</code> value for <code><a href="hop.html">hop()</a></code> (<code>1</code>), we can use this approach to
create standard N-grams.</p>
<p>The minimum and maximum length of windows can be controlled using the <code>min_length</code> and <code>max_length</code> arguments.
We can also indicate open/closes by providing <code>logical</code> vectors (the same length as <code>x</code>).</p>
<p>As mentioned above, if <code>reference</code> is a named <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> or <code><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame()</a></code>, <code>open</code> and
<code>close</code> and refer to the elements of <code>reference</code>.
This is useful if you want to open/close windows in reference to multiple vectors:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>        <span class="at">reference =</span> <span class="fu">data.frame</span>(<span class="at">Threes =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">26</span>), </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                               <span class="at">Fours =</span> <span class="fu">rep</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">26</span>)),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>        <span class="at">open =</span> Threes <span class="sc">==</span> Fours, <span class="at">close =</span> Fours <span class="sc">==</span> <span class="dv">1</span>)</span></code></pre><p></p></div><div class="section">
<h3 id="regular-expressions">Regular Expressions<a class="anchor" aria-label="anchor" href="#regular-expressions"></a></h3>


<p>If either <code>open</code> or <code>close</code> are provided a <code>character</code> string, this string is treated
as a regular expression and is matched against the <code>reference</code> vector.
For exaple, we could make windows in the alphabet starting or ending on each vowel:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="st">'[aeiou]'</span>, <span class="at">close =</span> open <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> close <span class="sc">-</span> <span class="dv">4</span>, <span class="at">close =</span> <span class="st">'[aeiou]'</span>, <span class="at">alignToOpen =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span></code></pre><p></p></div>
<p>(Notice that we can use the <code>alignToOpen</code> argument to change how the output is aligned.)</p>
<p>If the <code>stripRegex = TRUE</code> (not the default), the matching <code>open</code> or <code>close</code> regular expressions are removed
from the output.
This can be useful if the character/tokens used to indicate windows are no longer needed
once windowing is done.</p>
</div>

<div class="section">
<h3 id="special-references">Special References<a class="anchor" aria-label="anchor" href="#special-references"></a></h3>


<p>The <code>open</code> and <code>close</code> arguments have a few more special behaviors.
What if we'd like each of our windows to close right before the next window opens?
We can do this by making the <code>close</code> argument to refer to the <em>next</em> <code>open</code>, by
referring to <code>nextopen</code> object:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="st">'[aeiou]'</span>, <span class="at">close =</span> nextopen <span class="sc">-</span> 1L)</span></code></pre><p></p></div>
<p>Conversely, <code>open</code> can refer to the <code>prevclose</code> close:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> prevclose <span class="sc">+</span> <span class="dv">1</span>, <span class="at">close =</span> <span class="st">'[aeiou]'</span>, <span class="at">alignToOpen =</span> <span class="cn">FALSE</span>)</span></code></pre><p></p></div>
<p>Notice that when we called <code>context(letters, open = '[aeiou]', close = nextopen - 1L)</code>,
the window opening on <code>"u"</code> is not returned.
This is because there is no "<code>nextopen</code>" open to close on.
We can instead provide an <code>context()</code> alternative, using <code>|</code> (or):</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="st">'[aeiou]'</span>, <span class="at">close =</span> nextopen <span class="sc">-</span> 1L <span class="sc">|</span> <span class="dv">26</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span></code></pre><p></p></div>
<p>What if we don't know exactly how long our input vector is?
Refer to the <code>end</code> object:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(letters, <span class="at">open =</span> <span class="st">'[aeiou]'</span>, <span class="at">close =</span> nextopen <span class="sc">-</span> 1L <span class="sc">|</span> end)</span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="nested-windows">Nested Windows<a class="anchor" aria-label="anchor" href="#nested-windows"></a></h2>
    


<p>A common use case for <code>context()</code> is analyzing phrases indicated in music.
In <code>**kern</code>, phrases are indicated with opening (<code>(</code>) and close (<code>)</code>) parentheses,
which we can capture with regular expressions for <code>open</code> and <code>close</code>.
Here is an example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>nesting1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'(a'</span>, <span class="st">'b)'</span>, <span class="st">'(c'</span>, <span class="st">'d'</span>, <span class="st">'e)'</span>, <span class="st">'(d'</span>, <span class="st">'e'</span>, <span class="st">'f)'</span>, <span class="st">'(e'</span>, <span class="st">'f'</span>, <span class="st">'f#'</span>, <span class="st">'g'</span>, <span class="st">'g#'</span>, <span class="st">'a)'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">context</span>(nesting1, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>)</span></code></pre><p></p></div>
<p>Perfect.
However, what if there are nested phrasing indicators?</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>nesting2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'(a'</span>, <span class="st">'b)'</span>, <span class="st">'(c'</span>, <span class="st">'(d'</span>, <span class="st">'e)'</span>,  <span class="st">'(d'</span>, <span class="st">'e)'</span>, <span class="st">'f)'</span>, <span class="st">'(e'</span>, <span class="st">'(f'</span>, <span class="st">'(f#'</span>, <span class="st">'g)'</span>, <span class="st">'g#)'</span>, <span class="st">'a)'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>)</span></code></pre><p></p></div>
<p>That's not what we want!
By default, <code>context()</code> "pairs" each <code>open</code> with the next <code>close</code>, which often makes the most sense.
But in this case, we want different behavior.
We can get what we want by specifying <code>overlap = 'nested'</code>:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>)</span></code></pre><p></p></div>
<p>Now context aligns each <code>open</code> with the corresponding <code>close</code> at the same <em>nesting level</em>.
What if we are only interested in the highest (or lowest) level of nesting?
Use the <code>depth</code> argument, which can be non-zero integers: the highest level is <code>1</code>,
with "deeper" levels incrementing up.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="dv">1</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre><p></p></div>
<p>You can also use negative <code>depth</code> to specify from the deepest levels outward.
For example, in this case  <code>depth == -1</code> should get us that deepest level:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(nesting2, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre><p></p></div>
<p>I <code>depth</code> is <code>NULL</code> (the default), all depths are returned.</p>
    </div>
    <div class="section level2">
    <h2 id="controlling-overlap">Controlling Overlap<a class="anchor" aria-label="anchor" href="#controlling-overlap"></a></h2>
    


<p>There are some other options for controlling how windows can, or cannot, overlap.
Perhaps we'd like to look at every melodic phrase moving from so (dominant) to do (tonic).</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>melody <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'so'</span>, <span class="st">'la'</span>, <span class="st">'ti'</span>, <span class="st">'do'</span>, <span class="st">'so'</span>, <span class="st">'fi'</span>, <span class="st">'so'</span>, <span class="st">'la'</span>, <span class="st">'ti'</span>, <span class="st">'re'</span>, <span class="st">'do'</span>, <span class="st">'so'</span>, <span class="st">'la'</span>, <span class="st">'re'</span>, <span class="st">'do'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">context</span>(melody, <span class="at">open =</span> <span class="st">'so'</span>, <span class="at">close =</span> <span class="st">'do'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span></code></pre><p></p></div>
<p>This output is probably not what we want.
Again, <code>context()</code> (by default) pairs each opening with the next close <em>which hasn't already been paird</em>.
In this case, that means the third so is getting pairs with the third do,
even though there is another do in between!
We might want to try either the <code>"edge"</code> or <code>"none"</code> options for the <code>overlap</code> argument:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">context</span>(melody, <span class="at">open =</span> <span class="st">'so'</span>, <span class="at">close =</span> <span class="st">'do'</span>, <span class="at">overlap =</span> <span class="st">'edge'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">context</span>(melody, <span class="at">open =</span> <span class="st">'so'</span>, <span class="at">close =</span> <span class="st">'do'</span>, <span class="at">overlap =</span> <span class="st">'none'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">The </span><span class="st">`"edge"`</span><span class="at"> option allows the closing edge of windows to share a </span><span class="st">`</span>close<span class="st">`</span><span class="at">---in this case,</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="at">the second and third so (</span><span class="st">`</span>open<span class="st">`</span><span class="at">) are paired with the same do.</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">On the other hand, with </span><span class="st">`</span>overlap <span class="ot">=</span> <span class="st">"none"`</span><span class="at">, overlapping windows are simply not allowed, so the third </span><span class="st">`</span>open<span class="st">`</span><span class="at"> </span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">simply doesn't get paired with anything.</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">What if you would like to pair windows on their left (opening) edge?</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">If you specify </span><span class="st">`</span>rightward <span class="ot">=</span> FALSE<span class="st">`</span><span class="at">, the overlap argument works backwards (right-to-left) through</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="at">the input vector, starting on each </span><span class="st">`</span>close<span class="st">`</span><span class="at"> and ending on each </span><span class="st">`</span>open<span class="st">`</span><span class="at">.</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="at">By combining </span><span class="st">`</span>righward <span class="ot">=</span> FALSE<span class="st">`</span><span class="at"> with various </span><span class="st">`</span>overlap<span class="st">`</span><span class="at"> options, you can achieve a lot of windowing </span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="at">options you might need.</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="repeated-indices">Repeated Indices<a class="anchor" aria-label="anchor" href="#repeated-indices"></a></h2>
    


<p>Note that if <code>duplicates_indices = TRUE</code> (the default) the <code>open</code> and <code>close</code> arguments can
incorporate repeated indices, including multiple matches to a regular expression in the same index.
This is useful with, for example, nested phrases:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>nesting3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'(a'</span>, <span class="st">'b)'</span>, <span class="st">'((c'</span>, <span class="st">'d'</span>, <span class="st">'e)'</span>,  <span class="st">'(d'</span>, <span class="st">'e'</span>, <span class="st">'f))'</span>, <span class="st">'(e'</span>, <span class="st">'f'</span>, <span class="st">'((f#'</span>, <span class="st">'g)'</span>, <span class="st">'g#)'</span>, <span class="st">'a)'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">context</span>(nesting3, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="dv">1</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">context</span>(nesting3, <span class="at">open =</span> <span class="st">'('</span>, <span class="at">close =</span> <span class="st">')'</span>, <span class="at">overlap =</span> <span class="st">'nested'</span>, <span class="at">depth =</span> <span class="dv">2</span>)</span></code></pre><p></p></div>
<p>In some cases, you might want to turn <code>duplicate_indices = FALSE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use the built-in 'letters' vector</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">context</span><span class="op">(</span><span class="va">letters</span>, open <span class="op">=</span> <span class="fu"><a href="hop.html">hop</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, close <span class="op">=</span> <span class="va">open</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a,b,c,d" "e,f,g,h" "i,j,k,l" "m,n,o,p" "q,r,s,t" "u,v,w,x"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">context</span><span class="op">(</span><span class="va">letters</span>, open <span class="op">=</span> <span class="st">"[aeiou]"</span>, close <span class="op">=</span> <span class="va">nextopen</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">end</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a,b,c,d"     "e,f,g,h"     "i,j,k,l,m,n" "o,p,q,r,s,t" "u,v,w,x,y,z"</span>
<span class="r-in"><span><span class="fu">context</span><span class="op">(</span><span class="va">letters</span>, open <span class="op">=</span> <span class="st">"[aeiou]"</span>, close <span class="op">=</span> <span class="va">nextopen</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">end</span>, inPlace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "a,b,c,d"     NA            NA            NA            "e,f,g,h"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] NA            NA            NA            "i,j,k,l,m,n" NA           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] NA            NA            NA            NA            "o,p,q,r,s,t"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] NA            NA            NA            NA            NA           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "u,v,w,x,y,z" NA            NA            NA            NA           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] NA           </span>
<span class="r-in"><span><span class="fu">context</span><span class="op">(</span><span class="va">letters</span>, open <span class="op">=</span> <span class="st">"[aeiou]"</span>, close <span class="op">=</span> <span class="va">nextopen</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">end</span>, collapse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "a" "b" "c" "d"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "e" "f" "g" "h"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "i" "j" "k" "l" "m" "n"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "o" "p" "q" "r" "s" "t"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "u" "v" "w" "x" "y" "z"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># within.humdrumR</span></span></span>
<span class="r-in"><span><span class="va">chorales</span> <span class="op">&lt;-</span> <span class="fu"><a href="readHumdrum.html">readHumdrum</a></span><span class="op">(</span><span class="va">humdrumRroot</span>, <span class="st">"HumdrumData/BachChorales/.*.krn"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 4-grams</span></span></span>
<span class="r-in"><span><span class="fu"><a href="withinHumdrum.html">within</a></span><span class="op">(</span><span class="va">chorales</span>,</span></span>
<span class="r-in"><span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Token</span>, collapse <span class="op">=</span> <span class="st">'-&gt;'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>       <span class="fu">context</span><span class="op">(</span>open <span class="op">=</span> <span class="fu"><a href="hop.html">hop</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">open</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>       </span></span>
<span class="r-in"><span><span class="co"># phrases leading to fermatas</span></span></span>
<span class="r-in"><span><span class="fu"><a href="withinHumdrum.html">with</a></span><span class="op">(</span><span class="va">chorales</span>, </span></span>
<span class="r-in"><span>     <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">Token</span>, collapse <span class="op">=</span> <span class="st">','</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>     <span class="fu">context</span><span class="op">(</span>open <span class="op">=</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">prevclose</span> <span class="op">+</span> <span class="fl">1</span>, close <span class="op">=</span> <span class="st">';'</span>, overlap <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Nathaniel Condit-Schultz, Claire Arthur.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

